# 用語集

## A

### アプリケーション設定 (アプリ設定)
- **定義**: アプリケーションのデフォルト設定を定義するファイル
- **場所**: `./.agent/breakdown/config/app.yml`
- **特徴**: 必須ファイル。省略不可。定義された項目以外は無視される
- **用途**: アプリケーションの基本動作設定を定義

### app_prompt
- **定義**: プロンプトファイルの設定項目
- **設定項目**: `base_dir` (Baseフォルダの指定)
- **デフォルト値**: "./.agent/breakdown/prompts/app"
- **用途**: プロンプトファイルの場所を指定

### app_schema
- **定義**: Schemaファイルの設定項目
- **設定項目**: `base_dir` (Baseフォルダの指定)
- **デフォルト値**: "./.agent/breakdown/schema/app"
- **用途**: Schemaファイルの場所を指定

## B

### BreakdownConfig
- **定義**: 設定ファイルの統合管理を行うメインクラス
- **機能**: アプリ設定とユーザー設定を読み込み、統合する
- **使用例**: `let config = new BreakdownConfig();`
- **責務**: 複数の設定ファイルの順序管理と値の上書き統合

### BreakdownLogger
- **定義**: ライブラリ専用のログ出力システム
- **用途**: テストコードのデバッグ、構造化ログの出力
- **ログレベル**: DEBUG, INFO, WARN, ERROR
- **制御**: 環境変数 `LOG_LEVEL` で制御可能

### base_dir
- **定義**: 各機能（プロンプト、スキーマ）のファイル群を格納するディレクトリを指定するパラメータ
- **スコープ**: 機能別の個別ディレクトリ（app_prompt.base_dir, app_schema.base_dirなど）
- **相対基準**: プロジェクトルート（実行時のカレントディレクトリ）からの相対パス
- **設定場所**: app_prompt, app_schema の下位項目として個別設定
- **例**: `app_prompt.base_dir: "./.agent/breakdown/prompts/app"`

## D

### デフォルト値
- **定義**: 設定ファイルが存在しない項目に対する初期値
- **提供方法**: アプリケーション側から求められた場合のみ返却
- **特徴**: ライブラリ内では直接利用せず、設定ファイルを優先

## E

### ErrorManager
- **定義**: エラー管理を担当するコンポーネント
- **機能**: エラーメッセージの一元化、ログ出力の実行
- **用途**: システムとテストで共有可能なエラーメッセージ管理

## F

### fixture
- **定義**: テスト用の設定ファイルサンプル
- **方針**: 本番と同様の設定を使用する
- **理由**: 設定値の重要性から本番環境での動作保証を重視

## K

### 紛らわしい用語・仕様の明確化

#### base_dir と working_dir の違い

| 観点 | base_dir | working_dir |
|------|----------|-------------|
| **目的** | 機能別ファイル群の格納場所指定 | ユーザー設定の基準点設定 |
| **数量** | 複数存在（機能ごと） | システム全体で1つのみ |
| **設定者** | アプリ開発者が機能ごとに設定 | アプリ開発者がシステム全体を設定 |
| **変更可能性** | ユーザー設定で上書き可能 | ユーザー設定では変更不可 |
| **使用場面** | ファイル読み込み時の基準 | ユーザー設定ファイル配置の基準 |
| **階層関係** | working_dirとは独立 | すべてのユーザー設定の最上位 |

#### パス解決の違い
- **base_dir**: `プロジェクトルート + base_dir + ファイル名`
- **ユーザー設定**: `プロジェクトルート + .agent/breakdown/config/user.yml`（固定パス）

#### 設定例での比較
```yaml
# アプリ設定（app.yml）
working_dir: "./.agent/breakdown"  # システム全体の基準
app_prompt:
  base_dir: "./.agent/breakdown/prompts/app"  # プロンプト機能の基準
app_schema:
  base_dir: "./.agent/breakdown/schema/app"   # スキーマ機能の基準
```

#### 実際のファイル配置での理解
```
プロジェクトルート/
├── .agent/breakdown/              ← working_dir が指す場所
│   ├── config/
│   │   └── user.yml              ← 固定パス .agent/breakdown/config/user.yml
│   ├── prompts/app/              ← app_prompt.base_dir が指す場所
│   │   └── default.txt
│   └── schema/app/               ← app_schema.base_dir が指す場所
│       └── default.json
```

### 上書き統合
- **定義**: アプリ設定値をユーザー設定値で置き換える処理
- **ルール**: ユーザー設定に存在するキーの最上位キーで上書き
- **優先順位**: ユーザー設定 > アプリ設定
- **単位**: ネストされた階層の最上位キーが上書き単位

## L

### ログレベル
- **定義**: ログ出力の重要度を示す分類
- **種類**:
  - **DEBUG**: デバッグ情報（テスト環境のみ）
  - **INFO**: 通常の情報
  - **WARN**: 警告情報
  - **ERROR**: エラー情報

## S

### 責務分割
- **定義**: 各コンポーネントの役割を明確に分離する設計手法
- **目的**: テスト容易性の向上、ハンドリングのしやすさ、疎結合の実現
- **効果**: エラーハンドリングとバリデーションの分散実装

### 設定統合
- **定義**: 複数の設定ファイルを順序よく読み込み統合する処理
- **責任**: breakdownconfigライブラリが担当
- **手順**: アプリ設定読み込み → ユーザー設定読み込み → 値の上書き統合

### 疎結合
- **定義**: コンポーネント間の依存関係を最小限にする設計原則
- **利点**: テスト容易性、保守性、拡張性の向上
- **実装**: 責務分割による分散設計

## T

### テスト階層
- **定義**: テストケースを段階的に分類する構造
- **階層**:
  1. **基本機能テスト**: 基本的な動作確認
  2. **主要機能テスト**: 実環境での動作確認
  3. **エッジケーステスト**: 特殊ケースの確認
  4. **エラーケーステスト**: エラー処理の確認

## U

### ユーザー設定
- **定義**: ユーザーごとのカスタム設定を定義するファイル
- **場所**: `.agent/breakdown/config/user.yml`（固定パス）
- **特徴**: オプショナル。存在しなくても正常処理
- **制約**: working_dirは設定不可（アプリ設定でのみ設定可能）

## V

### バリデーション
- **定義**: 設定ファイルと設定値の妥当性を検証する処理
- **対象**: 
  - ディレクトリの存在確認
  - パスの形式チェック
  - 設定ファイルの構文確認
- **提供機能**: ディレクトリ検証、ファイル存在検証のインターフェイス

## W

### working_dir
- **定義**: ユーザー設定の起点となる単一の基準ディレクトリ（システム全体で唯一）
- **スコープ**: システム全体の基準点（すべてのユーザー設定がこの配下に配置）
- **相対基準**: プロジェクトルート（実行時のカレントディレクトリ）からの相対パス
- **設定場所**: アプリケーション設定でのみ設定可能（ユーザー設定では変更不可）
- **用途**: ユーザー設定ファイル（`.agent/breakdown/config/user.yml`）の配置場所を決定
- **デフォルト値**: "./.agent/breakdown"
- **参照**: `$working_dir` として他の設定やシステム内部で使用

## Y

### YAML形式
- **定義**: 設定ファイルの記述形式
- **制約**: シンプルな単一ドキュメントのみ対応
- **特徴**: 人間が読みやすい構造化データ形式
- **用途**: アプリ設定、ユーザー設定の両方で使用

---

## 重要概念の整理

### ディレクトリ概念の階層関係

```
【概念的な階層】
プロジェクトルート（実行基準）
├── .agent/breakdown/config/（固定パス・ユーザー設定の場所）
│   └── user.yml（ユーザー設定ファイル）
├── base_dir（機能別基準点・複数存在）
│   ├── app_prompt.base_dir（プロンプト機能）
│   └── app_schema.base_dir（スキーマ機能）
```

### 設定ファイルの役割分担

- **アプリケーション設定**: システム構造の定義（working_dir, 各base_dir）
- **ユーザー設定**: 個別機能のカスタマイズ（base_dirの上書きなど）

### パス解決の原則

1. すべてのパスはプロジェクトルートからの相対パス
2. ユーザー設定は固定パス（.agent/breakdown/config/user.yml）から読み込み
3. base_dirは実際のファイル操作時の基準ディレクトリ
4. ユーザー設定でbase_dirを上書き可能（working_dirは不可）
