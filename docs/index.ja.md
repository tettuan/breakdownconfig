# 概要
このアプリケーションは、Denoのライブラリである。
https://jsr.io/@tettuan/breakdownconfig に登録する。

## Usage
breakdownconfig を 第三者アプリケーションが import すると、設定ファイルの読み込み処理を行うことができる。

### アプリケーション利用者のUssage
- デフォルト設定はアプリ設定を用いる
- ユーザーごとに設定を切り替える場合は、ユーザー設定を設ける
- ユーザー設定は、アプリ設定の `working_dir` 項目で設定されたディレクトリに存在する

### アプリケーションからの読み込み
`import * as breakdownconfig from "@tettuan/breakdownconfig";


### アプリケーションでの利用例

```typescript
let config = new BraekdownConfig();
```

### クラス名
**BreakdownConfig** 


## 設定ファイルの種類
設定ファルの種類は2つあり、
1. アプリケーション設定(=アプリ設定)
2. ユーザー設定
の2つである。

BraekdownConfig は2種類の設定ファイルを読み込み、統合する。

例えば、
```typescript
let config = new BraekdownConfig();
```
と宣言した config は、 アプリ設定ファイルを読み込み、その後ユーザー設定ファイルを読み込む。
設定値は、アプリ設定よりもユーザー設定を優先する。（アプリ設定値をユーザー設定値で上書きする）

### 設定ごとの仕様説明
以下のファイルに記載されている。
- `./app.ja.md` : アプリケーション設定ファイルについて記載されている。
- `./user.ja.md` : ユーザー設定ファイルについて記載されている。

# 設定ファイルの読み込み
1. アプリ設定
  - 必須。省略できない。
  - 設定ファイルが存在しない場合はエラーで終了する。
  - `working_dir` 設定がユーザー設定の起点ディレクトリとなる。
2. ユーザー設定
  - アプリ設定の `working_dir` を起点とする(`$working_dir`とする)
  - `$working_dir/config/user.yml` の存在を確認する。
  - 存在がなくても正常処理とする。（warning出力を行うのみ）
  - 設定値を読み込み、同一キーのアプリ設定値を上書きする。
    - ユーザー設定は必要な設定のみ記述できる。全ての項目が任意である。
  
## 設定ファイルの作成責任
- `new BraekdownConfig()` したアプリケーションが責任を持って初期ファイル作成する。
  - アプリケーションが必要な設定値を知るために、BraekdownConfigはデフォルト値を返すことはできる（ファイルは作成しない）。

## 設定値の統合責任
- このライブラリが担う。
- 複数の設定ファイルを順序よく読み込み、値を上書き統合する。

# テスト
`./tests.ja.md` を参照すること。

# エラー処理
- エラーメッセージは、システムとテストで共有できるよう一元化したエラーメッセージ管理を行う。

# バリデーション
設定ファイルの読み込み時に、設定ファイルのバリデーションを行う。
- ディレクトリの存在確認
- パスの形式チェック

設定ファイルを読み込んだのちに、設定ファイルの値をバリデーションする。
（設定値の種類を事前把握できている項目のみ。）
- 設定されたディレクトリの存在確認
- パスの形式チェック

## アプリケーション側へのバリデーションインターフェイスの提供
- ディレクトリ（PATH）の検証インターフェイス
  - 設定値がディレクトリ記述として正しいか？
- ファイルの存在の検証インターフェイス
  - 設定値に基づくファイルが存在するか？

# BreakdownLogger 
- テストコードのみデバッグする。
- 公開対象のライブラリのコードは、テストを通じてデバッグされる。
  - 公開用のコードのデバッグが必要な場合、必要なデバッグのためのテストコードを追加する。

## ログ出力の仕様
- エラー管理（ErrorManager）でログ出力を行う
- ログレベルは以下の通り
  - DEBUG: デバッグ情報（テスト環境のみ）
  - INFO: 通常の情報
  - WARN: 警告情報
  - ERROR: エラー情報
- ログ出力は構造化データとして出力される
- 環境変数 `LOG_LEVEL` でログレベルを制御可能

