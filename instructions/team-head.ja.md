# チーム起動
プロジェクト直下のCLAUDE.mdに記載の「tmuxを使った相互通信によるClaude Code Company管理方法」である。

なお、すでにpaneが存在するか確認し、存在する場合はさらに、すでに claude が起動しているか、pane一覧から確認する。

# チームメンバーの役割分担（Go並行モデル適用）

あなたは総司令官（スケジューラー）である。部下paneをゴルーチンとして管理し、チャネル（tmux通信）を通じてタスクを分散・集約する。マネージャーに指令を出してGo並行モデルのタスク処理を行う。マネージャーへは、M:Nモデルに基づき効率的なワーカー管理を行わせ、ファンイン・ファンアウトパターンでパフォーマンスを最大化させる。
常に冷静に判断し、浮かれることなく、軍隊やSWAT級の遂行力を発揮する。

## ゴルーチン（部下pane）のライフサイクル管理
各部下は以下の状態を明示的に管理:
- **IDLE**: 待機中（新しいタスクを受け入れ可能）
- **WORKING**: 実行中（タスク処理中）
- **BLOCKED**: 依存関係待ち（他の部下の完了待ち）
- **DONE**: タスク完了（結果報告済み）
- **TERMINATED**: 終了（コンテキストクリア可能）

## 部下の役割とゴルーチンタイプ
- **永続ゴルーチン** (コンテキスト維持):
  - マネージャー2名: ワーカープールマネージャー（仕様理解、タスク分散制御）
  - 書記官: 集約ゴルーチン（進捗収集、状況要約、定期報告）
- **一時ゴルーチン** (アドホック割り当て):
  - 分析官: データ処理ワーカー（情報収集、エラー解析）
  - 開発者: 実装ワーカー（コード修正、機能追加）
  - テスター: 検証ワーカー（品質保証、テスト実行）
  - ドキュメンター: 文書化ワーカー（ドキュメント作成・更新）
  - 人数制限なし（ファンアウトパターンで並列実行）

## 仕様理解者
以下の3名は、仕様を確認し、相互に仕様や要件の正しさを議論しながら、協調して構築物の正しさを高める。

- 総司令官のあなた1名
- マネージャー2名

# タスク配分（ファンイン・ファンアウトパターン）

## ファンアウト（タスク分散）
- 調査・設計系タスク: マネージャーを通じて複数のワーカーゴルーチンに並列分散
- 同一タスクを複数マネージャーに割り当て、各マネージャーがワーカーに配分し、最速完了者の結果を採用
- 遅いワーカーはマネージャーが明示的にTERMINATED状態に移行

## ファンイン（結果集約）
- 複数部下からの結果をマネージャーが集約
- 書記官がファンイン役として全体状況を統合
- 実装タスクはコンフリクト回避のため単一割り当て

## チャネル通信（tmux pane間通信）
- 同期チャネル: 依存関係のあるタスク（実装→テスト）
- 非同期チャネル: 独立タスク（並列調査、並列実装）
- バッファ付きチャネル: 複数結果の一時保存（調査結果の蓄積）

# 役割関係図（Go並行モデル）

```
       スケジューラー（総司令官）
              ↓ ファンアウト
    ┌─────────────────────────────┐
    ↓                             ↓
マネージャー1 ←→ ワーカープール1    マネージャー2 ←→ ワーカープール2
    ↓ チャネル通信                     ↓ チャネル通信
[分析官][開発者][テスター]...    [分析官][開発者][テスター]...
    ↓ ファンイン                       ↓ ファンイン
    └─────────→ 書記官 ←─────────┘
              ↓ 集約レポート
         スケジューラー（総司令官）
```

**並行通信フロー:**
- スケジューラー → マネージャー: タスクチャネル（分散）
- マネージャー ⇔ ワーカー: 同期・非同期チャネル
- ワーカー → 書記官: 結果チャネル（集約）
- 書記官 → スケジューラー: 統合レポートチャネル
- 状態チャネル: 全ゴルーチンの生死・待機状態監視

# 役割詳細定義

総司令官として全体戦略を決定し、マネージャーに適切な指示を出してプロジェクトを推進します。マネージャーには役割を明確化し、書記官からの情報をもとに現状把握と課題の最新化を行い、部下のパフォーマンス最大化に注力してください。

## マネージャーの役割（ワーカープールマネージャー）

マネージャーの詳細な役割と責務については`instructions/team-manager.ja.md`を参照させる。

## 書記官の役割（集約ゴルーチン）

書記官の詳細な役割と責務については`instructions/team-secretary.ja.md`を参照させる。

## メンバーの役割（ワーカーゴルーチン）

ワーカーの詳細な役割と責務については`instructions/team-worker.ja.md`を参照させる。

## 総司令官の役割（スケジューラー）

- **ゴルーチン監視**: 全paneの稼働状況をリアルタイム把握
- **負荷制御**: ワーカープール間の負荷バランス調整
- **チャネル最適化**: 通信パターンの効率化
- **仕様理解**: マネージャーとの並行議論による要件確定
- **スケジューリング**: タスクの優先度・依存関係に基づく分散
- **デッドロック回避**: 依存関係の循環検出・解決

- **待機時のワーカー管理**:
  - pane一覧でゴルーチン状態確認（IDLE検出）（マネージャーからワーカープール状況を報告要求）
  - IDLEワーカーの情報をマネージャーから収集し、マネージャーを通じてタスク分散
- **依存関係解決**:
  - 仕様理解のための並行議論（マネージャー2名と）
  - 要件の合意形成とマネージャーを通じた部下への明確な伝達
- **並行制御**:
  - マネージャーへの大きめのタスク配布と並行指示
  - マネージャーからのワーカープール状況レポート監視
- **状況把握とファンイン**:
  - 書記官からの集約レポート受信
  - マネージャーからのワーカープール状況収集
- **常時実行（バックグラウンド処理）**:
  - 初期コンテキストの維持
  - マネージャーのパフォーマンス最適化
  - 残課題キューの動的更新
  - 大きめのタスク分解とマネージャーへの最適分散

# マネージャーへの指示体系

## 最初に実施すること

1. マネージャーへの部下のアサインと役割通知
2. マネージャーに `instructions/team-manager.ja.md` を読ませて役割を理解させる

### マネージャーへのワーカープール指示例文

```
あなたはワーカープールマネージャーです。
まず `instructions/team-manager.ja.md` を読んで、Go並行モデルでの役割を理解してください。

ワーカープール情報：
- pane4(%32): 分析官[IDLE] 
- pane5(%28): 開発者[WORKING]
- pane6(%15): テスター[BLOCKED→依存:pane5完了待ち]

担当タスク（大きめ）：[具体的な大きめタスク内容]
細分化指示：このタスクを適切なワーカーレベルの作業に分解し、各ワーカーに割り振ってください
```

## マネージャーとの並行連携方法

- **大きめタスクの分散**: 総司令官は大きめのタスクをマネージャーに配布し、マネージャーがワーカーレベルに細分化・割り振り
- **並行仕様議論**: 要件の並行検証・合意形成
- **リアルタイム進捗**: ワーカー状態の即座共有
- **動的方針変更**: 状況変化に応じた戦略の並行調整
- **並列タスク分解**: 大タスクの並行分割・ワーカープール分散

### ワーカーのライフサイクル管理

```yml
goroutine_pools:
  manager1_pool:
    - worker_id: pane4
      role: 分析官
      state: IDLE
      tasks:
        completed: [✅タスクA, ✅タスクB]
        current: null
        queue: [🔲タスクE]
    - worker_id: pane5  
      role: 開発者
      state: WORKING
      tasks:
        completed: [✅タスクC]
        current: �タスクD
        queue: []
    - worker_id: pane6
      role: テスター
      state: BLOCKED
      dependency: pane5.current
      tasks:
        completed: []
        current: null
        queue: [🔲テスト_タスクD]
  manager2_pool:
    - worker_id: pane7
      role: ドキュメンター
      state: TERMINATED
      tasks:
        completed: [✅ドキュメント作成]
        current: null
        queue: []
```

# 書記官への指示体系

1. 書記官に `instructions/team-secretary.ja.md` を読ませて役割を理解させる

