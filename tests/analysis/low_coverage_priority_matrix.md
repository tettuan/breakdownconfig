# 低カバレッジファイル優先度マトリックス

## 評価基準

- **ビジネス影響度**: システム全体への影響（1-5点）
- **使用頻度**: 実行される頻度（1-5点）
- **複雑度**: コードの複雑さ（1-5点）
- **セキュリティ重要度**: セキュリティへの影響（1-5点）
- **修正難易度**: テスト追加の困難さ（1-5点、低い方が良い）

## 優先度マトリックス

| ファイル                     | カバレッジ | ビジネス | 使用頻度 | 複雑度 | セキュリティ | 修正難易度 | 総合点 | 優先度 |
| ---------------------------- | ---------- | -------- | -------- | ------ | ------------ | ---------- | ------ | ------ |
| **config_manager.ts**        | 32%        | 5        | 5        | 4      | 3            | 2          | **17** | **A**  |
| **unified_error_manager.ts** | 28%        | 4        | 4        | 5      | 2            | 3          | **16** | **A**  |
| **path_validator.ts**        | 47%        | 3        | 4        | 3      | 5            | 2          | **15** | **A**  |
| **base_loader.ts**           | 41%        | 4        | 3        | 4      | 2            | 3          | **14** | **B**  |
| **safe_config_loader.ts**    | 49%        | 3        | 3        | 3      | 3            | 2          | **12** | **B**  |
| **legacy_adapter.ts**        | 45%        | 2        | 2        | 3      | 1            | 4          | **8**  | **C**  |
| **unified_result.ts**        | 43%        | 2        | 2        | 2      | 1            | 3          | **7**  | **C**  |

## 詳細分析

### 優先度A: 緊急対応必要

#### 1. config_manager.ts (32% → 目標80%)

**現状分析**:

- システムのメインエントリーポイント
- ユーザー向けAPIの中核
- エラーハンドリング、設定マージ、キャッシュ機能を担当

**未カバー領域**:

- エラー状態からの回復処理
- 同期・非同期処理の境界
- キャッシュ無効化のタイミング
- ユーザー設定上書きロジック

**テスト追加計画**:

```typescript
// 追加が必要なテストシナリオ
-破損した設定ファイルからの回復 -
  部分的な設定更新 -
  並行アクセス時の整合性 -
  メモリ使用量の最適化検証;
```

#### 2. unified_error_manager.ts (28% → 目標75%)

**現状分析**:

- 全エラーの統合管理
- エラー変換・国際化を担当
- 複雑な条件分岐を多数含有

**未カバー領域**:

- レガシーエラーからの変換
- 国際化メッセージの生成
- エラーコンテキストの保持
- エラーチェーンの処理

**テスト追加計画**:

```typescript
// 重点テスト項目
-全エラー種別の変換テスト -
  多言語対応の検証 -
  エラー履歴の追跡 -
  パフォーマンス影響の測定;
```

#### 3. path_validator.ts (47% → 目標70%)

**現状分析**:

- セキュリティの最前線
- パストラバーサル攻撃の防御
- ファイルシステム操作の検証

**未カバー領域**:

- 特殊文字を含むパス
- シンボリックリンクの処理
- 権限チェックの境界
- プラットフォーム固有の動作

**テスト追加計画**:

```typescript
// セキュリティ重点テスト
-悪意のあるパス入力への対応 -
  Unicode文字の適切な処理 -
  ファイルサイズ制限の検証 -
  権限昇格攻撃の防御;
```

### 優先度B: 中期対応

#### 4. base_loader.ts (41% → 目標70%)

**現状分析**:

- 全ローダーの抽象基底クラス
- 共通的なロード処理を定義
- 拡張性の基盤を提供

**テスト戦略**:

- 抽象メソッドの実装パターン網羅
- 継承関係での動作検証
- エラー伝播の一貫性確認

#### 5. safe_config_loader.ts (49% → 目標65%)

**現状分析**:

- 型安全な設定読み込み
- バリデーション機能統合
- エラー境界の明確化

**テスト戦略**:

- 型変換の境界テスト
- バリデーション失敗時の動作
- メモリ効率の検証

### 優先度C: 長期対応

#### 6. legacy_adapter.ts (45% → 目標60%)

**段階的廃止予定のため最小限の改善**

- 既存機能の後方互換性確保
- 移行期間中の安定性維持

#### 7. unified_result.ts (43% → 目標60%)

**ユーティリティ性質のため実用テスト重視**

- 実際の使用パターンに基づくテスト
- パフォーマンス特性の検証

## 実装スケジュール

### Week 1: 優先度A集中対応

**Day 1-2**: config_manager.ts

- 基本機能の網羅テスト追加
- エラーハンドリングパスの検証
- 実行時間: 16時間

**Day 3-4**: unified_error_manager.ts

- エラー変換ロジックの検証
- 国際化機能のテスト
- 実行時間: 16時間

**Day 5**: path_validator.ts

- セキュリティテストの強化
- エッジケースの網羅
- 実行時間: 8時間

### Week 2: 優先度B + 統合テスト

**Day 1-2**: base_loader.ts & safe_config_loader.ts

- 抽象クラステストの実装
- 型安全性の検証
- 実行時間: 16時間

**Day 3-5**: 統合テスト実装

- E2Eシナリオの追加
- パフォーマンステストの実装
- CI/CD統合の確認
- 実行時間: 24時間

## 品質ゲート

### 各ファイルの最小要件

- [ ] カバレッジ目標達成
- [ ] 型エラー0件
- [ ] リンター警告0件
- [ ] パフォーマンス要件達成

### 統合要件

- [ ] 全テストスイート < 30秒実行
- [ ] メモリ使用量 < 50MB
- [ ] 並行実行時の安定性確保

## 継続監視指標

### 日次チェック項目

- カバレッジ進捗率
- 新規失敗テスト数
- 実行時間の変化
- リソース使用量

### 週次レビュー項目

- 優先度の再評価
- スケジュール調整
- 品質メトリクスの分析
- チーム負荷の確認
